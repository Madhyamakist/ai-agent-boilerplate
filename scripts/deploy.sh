#!/bin/bash
set -e  # exit if any command fails

echo "==== Starting deploy.sh ===="


cd /home/vivek/Ai-agent-boilerplate/ai-agent-boilerplate

echo "Activating virtualenv..."
source venv/bin/activate
 
cd code

echo "Cleaning old .env and Flask logs..."
rm -f .env
rm -f flask.log

echo "Installing dependencies..."
pip install -r requirements.txt

echo "Generating .env file using Python script..."
python3 get_env.py

echo "Restarting service..."
pkill -f flask || true
cd /home/vivek/Ai-agent-boilerplate/ai-agent-boilerplate/code
export FLASK_APP=app.py
nohup flask run --host=0.0.0.0 --port=5000 > flask.log 2>&1 &


echo "âœ… Deployment complete!"
